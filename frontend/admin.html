<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin - Manage Events</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 30px; }
    h1 { color: #0066cc; }
    nav {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    nav button, nav a {
      background-color: #0066cc;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 6px;
      cursor: pointer;
      text-decoration: none;
      transition: background 0.3s;
    }
    nav button:hover, nav a:hover {
      background-color: #004999;
    }
    input, button { padding: 8px; margin: 5px; }
    table { border-collapse: collapse; width: 100%; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
    th { background: #f0f0f0; }
  </style>
</head>
<body>
  <script>
    // ‚úÖ Cek apakah admin sudah login
    if (!localStorage.getItem("adminToken")) {
      alert("‚ö†Ô∏è Please login as admin first!");
      window.location.href = "index.html";
    }
  </script>

  <h1>üßë‚Äçüíº Admin - Event Management</h1>

  <!-- üîπ Navigasi -->
  <nav>
    <a href="index.html">üè† Home</a>
    <a href="all_participant.html">üìã View Participants</a>
    <button onclick="logout()">üö™ Logout</button>
  </nav>

  <h2>Add / Edit Event</h2>
  <form id="eventForm">
    <input type="hidden" id="event_id">
    <input type="text" id="title" placeholder="Event Title" required><br>
    <input type="date" id="date" required><br>
    <input type="text" id="location" placeholder="Location" required><br>
    <input type="number" id="quota" placeholder="Quota" required><br>
    <button type="submit">Save Event</button>
  </form>

  <h2>Event List</h2>
  <table>
    <thead>
      <tr><th>ID</th><th>Title</th><th>Date</th><th>Location</th><th>Quota</th><th>Action</th></tr>
    </thead>
    <tbody id="eventTable"></tbody>
  </table>

  <script>
    const API_URL = "http://127.0.0.1:8000";
    const ADMIN_TOKEN = localStorage.getItem("adminToken");

    function logout() {
      localStorage.removeItem("adminToken");
      alert("Logged out!");
      window.location.href = "index.html";
    }

    function backHome() {
        localStorage.removeItem("adminToken");
        alert('Back to Home');
        window.location.href = "index.html";
    }

    // üîπ Load daftar event
    async function loadEvents() {
      const res = await fetch(`${API_URL}/events`);
      const data = await res.json();
      const tbody = document.getElementById("eventTable");
      tbody.innerHTML = data.map(e => `
        <tr>
          <td>${e.id}</td>
          <td>${e.title}</td>
          <td>${e.date}</td>
          <td>${e.location}</td>
          <td>${e.quota}</td>
          <td>
            <button onclick="editEvent(${e.id}, '${e.title}', '${e.date}', '${e.location}', ${e.quota})">Edit</button>
            <button onclick="deleteEvent(${e.id})">Delete</button>
          </td>
        </tr>
      `).join("");
    }

    // üîπ Hapus event
    async function deleteEvent(id) {
      if (!confirm("Delete this event?")) return;
      await fetch(`${API_URL}/events/${id}`, {
        method: "DELETE",
        headers: { "token": ADMIN_TOKEN }
      });
      loadEvents();
    }

    // üîπ Edit event
    function editEvent(id, title, date, location, quota) {
      document.getElementById("event_id").value = id;
      document.getElementById("title").value = title;
      document.getElementById("date").value = date;
      document.getElementById("location").value = location;
      document.getElementById("quota").value = quota;
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    // üîπ Simpan event (Tambah/Edit)
    document.getElementById("eventForm").addEventListener("submit", async e => {
      e.preventDefault();
      const id = document.getElementById("event_id").value;
      const title = document.getElementById("title").value;
      const date = document.getElementById("date").value;
      const location = document.getElementById("location").value;
      const quota = document.getElementById("quota").value;

      const method = id ? "PUT" : "POST";
      const url = id
        ? `${API_URL}/events/${id}?title=${encodeURIComponent(title)}&date=${encodeURIComponent(date)}&location=${encodeURIComponent(location)}&quota=${quota}`
        : `${API_URL}/events?title=${encodeURIComponent(title)}&date=${encodeURIComponent(date)}&location=${encodeURIComponent(location)}&quota=${quota}`;

      await fetch(url, { method, headers: { "token": ADMIN_TOKEN } });
      alert("‚úÖ Event saved successfully!");
      e.target.reset();
      loadEvents();
    });

    loadEvents();
  </script>
</body>
</html>
